# Economic of co-firing in two power plants in Vietnam
#
#  Tests
#
# (c) Minh Ha-Duong, An Ha Truong   2016
#     minh.haduong@gmail.com
#     Creative Commons Attribution-ShareAlike 4.0 International
#
#

from parameters import NinhBinh,MongDuong1
from parameters import TimeHorizon,DiscountRate,BiomassRatio,ElectricityTariffUSD

print(MongDuong1.Capacity)
print(NinhBinh.Capacity)

print("")

from npv import npv,ElectricitySaleQuantity,CashInflow,TotalCapitalCost,FuelCost,OperationMaintenanceCost,IncomeTax,NetCashFlow

print(TimeHorizon)
print(DiscountRate)

print("")

print("Tests for NPV function")
print("")

print("Null cash flow")
def nocash(t):
    return 0
print(npv(nocash))
if npv(nocash) == 0:
    print("OK")
else:
    print("ERROR: the null cash flow should have null NPV")

print("")

print("Unit cash flow")
def unitcash(t):
    return 1
print(repr(npv(unitcash)))
CommonRatio = 1/(1+DiscountRate)
SumOfGeometricSequence = (1 - CommonRatio**(TimeHorizon+1)) / (1 - CommonRatio)
print(repr(SumOfGeometricSequence))
if abs(npv(unitcash) - SumOfGeometricSequence) < 1E-12:
    print("OK")
else:
    print("ERROR: NPV of the unit cash flow is wrong")

print("")
print("Year")
for t in range(TimeHorizon+1):
    print (t,
           ElectricitySaleQuantity(MongDuong1,t),
           round(CashInflow(MongDuong1,t)),
           TotalCapitalCost(MongDuong1,t),
           round(FuelCost(MongDuong1,t)),
           round(EarnBeforeTax(MongDuong1,t)),
           round(IncomeTax(MongDuong1,t)),
           round(OperationMaintenanceCost(MongDuong1,t)),
           round(NetCashFlow(MongDuong1,t))
          )

print("")

print ("No sales on year zero")
if ElectricitySaleQuantity(MongDuong1,0) == 0:
    print("OK")
else:
    print("ERROR: Electricity sales quantity Mong Duong 1 year zero ",  ElectricitySaleQuantity(MongDuong1,0) )

print ("Sales on year one")
if ElectricitySaleQuantity(MongDuong1,1) == MongDuong1.Generation * BiomassRatio:
    print("OK")
else:
    print("ERROR: Electricity sales quantity Mong Duong 1 year one ",  ElectricitySaleQuantity(MongDuong1,1) )

print ("Sales remain constant")
if ElectricitySaleQuantity(MongDuong1,1) == ElectricitySaleQuantity(MongDuong1,TimeHorizon) :
    print("OK")
else:
    print("ERROR: Electricity sales quantity Mong Duong 1 year different in year 1 and year ", TimeHorizon )

print("")

print ("No Cash Inflow on year zero")
if CashInflow(MongDuong1,0) == 0:
    print("OK")
else:
    print("ERROR: Cash Inflow Mong Duong 1 year zero ",  CashInflow(MongDuong1,0) )

print ("Cash inflow on year one")
if CashInflow(MongDuong1,1) == MongDuong1.Generation * BiomassRatio * ElectricityTariffUSD:
    print("OK")
else:
    print("ERROR: Cash Inflow Mong Duong 1 year one ",  ElectricitySaleQuantity(MongDuong1,1) )

print ("Cash inflow remain constant")
if CashInflow(MongDuong1,1) == CashInflow(MongDuong1,TimeHorizon) :
    print("OK")
else:
    print("ERROR: Cash Inflow Mong Duong 1 year different in year 1 and year ", TimeHorizon )

print("")

print ("Total capital cost on year zero")
if TotalCapitalCost(MongDuong1,0) == MongDuong1.CapitalCost * MongDuong1.Capacity * BiomassRatio :
    print("OK")
else:
    print("ERROR: Total capital cost Mong Duong 1 year zero ",  TotalCapitalCost(MongDuong1,0) )

print ("Capital cost on year 1 is zero")
if TotalCapitalCost(MongDuong1,1) == 0:
    print("OK")
else:
    print("ERROR: Total capital cost Mong Duong 1 year one ",  TotalCapitalCost(MongDuong1,1) )

print ("Capital cost on last year is zero")
if TotalCapitalCost(MongDuong1,TimeHorizon) == 0:
    print("OK")
else:
    print("ERROR: Total capital cost Mong Duong 1 last year ",  TotalCapitalCost(MongDuong1,TimeHorizon) )


print("")

print ("No fuel cost on year zero")
if FuelCost(MongDuong1,0) == 0:
    print("OK")
else:
    print("ERROR: Fuel Cost Mong Duong 1 year zero ",  FuelCost(MongDuong1,0) )

print ("Fuel Cost on year one")
if FuelCost(MongDuong1,1) == MongDuong1.BiomassRequired * MongDuong1.BiomassUnitCost:
    print("OK")
else:
    print("ERROR: FuelCost Mong Duong 1 year one ",  FuelCost(MongDuong1,1) )

print ("Fuel cost remain constant")
if FuelCost(MongDuong1,1) == FuelCost(MongDuong1,TimeHorizon) :
    print("OK")
else:
    print("ERROR: Fuel Cost Mong Duong 1 year different in year 1 and year ", TimeHorizon )

